---
import { text } from "../../data/i18n";
import Button from "../common/Button.astro";
import LustreText from "../ui/lustretext";
import { Badge } from "../ui/badge";
import { Mail, Send } from "lucide-react";
import Globe from "../ui/globe";

const t = text.contact;
---

<section id="contact" class="relative py-24 bg-[#121212] overflow-hidden">
  {/* Decorative Background Elements */}
  <div
    class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none"
  >
    <div
      class="absolute top-1/4 -right-64 w-96 h-96 bg-[#D4AF37]/5 rounded-full blur-3xl"
    >
    </div>
    <div
      class="absolute bottom-1/4 -left-64 w-96 h-96 bg-[#E5E4E2]/5 rounded-full blur-3xl"
    >
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-6 relative z-10">
    {/* Header */}
    <div class="text-center mb-16">
      <div
        class="flex items-center justify-center gap-3 mb-6 animate-in fade-in slide-in-from-bottom-4 duration-700"
      >
        <span class="h-px w-12 bg-[#D4AF37]/60"></span>
        <span
          class="text-[#D4AF37] font-display tracking-[0.2em] text-sm uppercase"
          >Mari Terhubung</span
        >
        <span class="h-px w-12 bg-[#D4AF37]/60"></span>
      </div>

      <h2 class="mb-6">
        <LustreText
          client:visible
          text={t.title}
          className="text-4xl md:text-5xl font-display font-bold text-[#E5E4E2]"
        />
      </h2>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-24 items-center">
      {/* Left Column - Globe */}
      <div
        class="relative w-full h-[400px] lg:h-[600px] flex items-center justify-center order-2 lg:order-1"
      >
        <div
          class="absolute inset-0 bg-gradient-to-t from-[#121212] via-transparent to-transparent z-10 pointer-events-none"
        >
        </div>
        <Globe
          client:only="react"
          baseColor={[0.1, 0.1, 0.1]}
          glowColor={[0.83, 0.69, 0.22]}
          markerColor={[0.9, 0.9, 0.9]}
          markers={[{ location: [-6.2088, 106.8456], size: 0.1 }]}
          scale={1}
          className="w-full h-full opacity-80"
        />
      </div>

      {/* Right Column - Form */}
      <div
        class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl p-8 md:p-12 shadow-[0_0_50px_rgba(0,0,0,0.5)] order-1 lg:order-2"
      >
        <div class="mb-8">
          <h3 class="text-2xl font-display font-bold text-[#E5E4E2] mb-2">
            Mari Bekerja Sama
          </h3>
          <p class="text-neutral-400 font-light">
            Punya ide proyek atau ingin diskusi teknologi terbaru? Saya selalu
            terbuka untuk peluang baru.
          </p>
        </div>

        <form id="contact-form" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="relative group">
              <input
                type="text"
                id="name"
                name="name"
                required
                placeholder=" "
                class="peer w-full px-5 py-4 rounded-xl bg-black/40 border border-white/10 text-[#E5E4E2] focus:border-[#D4AF37]/50 focus:ring-1 focus:ring-[#D4AF37]/50 outline-none transition-all duration-300"
              />
              <label
                for="name"
                class="absolute left-4 -top-2.5 px-1 rounded bg-[#121212] text-[10px] items-center uppercase tracking-widest text-[#D4AF37] font-display transition-all duration-300
                               peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:bg-transparent peer-placeholder-shown:text-base peer-placeholder-shown:text-neutral-500 peer-placeholder-shown:normal-case peer-placeholder-shown:tracking-normal
                               peer-focus:-top-2.5 peer-focus:translate-y-0 peer-focus:bg-[#121212] peer-focus:text-[10px] peer-focus:text-[#D4AF37] peer-focus:uppercase peer-focus:tracking-widest"
              >
                {t.name}
              </label>
            </div>
            <div class="relative group">
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder=" "
                class="peer w-full px-5 py-4 rounded-xl bg-black/40 border border-white/10 text-[#E5E4E2] focus:border-[#D4AF37]/50 focus:ring-1 focus:ring-[#D4AF37]/50 outline-none transition-all duration-300"
              />
              <label
                for="email"
                class="absolute left-4 -top-2.5 px-1 rounded bg-[#121212] text-[10px] items-center uppercase tracking-widest text-[#D4AF37] font-display transition-all duration-300
                               peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:bg-transparent peer-placeholder-shown:text-base peer-placeholder-shown:text-neutral-500 peer-placeholder-shown:normal-case peer-placeholder-shown:tracking-normal
                               peer-focus:-top-2.5 peer-focus:translate-y-0 peer-focus:bg-[#121212] peer-focus:text-[10px] peer-focus:text-[#D4AF37] peer-focus:uppercase peer-focus:tracking-widest"
              >
                {t.email}
              </label>
            </div>
          </div>

          <div class="relative group">
            <input
              type="text"
              id="subject"
              name="subject"
              required
              placeholder=" "
              class="peer w-full px-5 py-4 rounded-xl bg-black/40 border border-white/10 text-[#E5E4E2] focus:border-[#D4AF37]/50 focus:ring-1 focus:ring-[#D4AF37]/50 outline-none transition-all duration-300"
            />
            <label
              for="subject"
              class="absolute left-4 -top-2.5 px-1 rounded bg-[#121212] text-[10px] items-center uppercase tracking-widest text-[#D4AF37] font-display transition-all duration-300
                           peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:bg-transparent peer-placeholder-shown:text-base peer-placeholder-shown:text-neutral-500 peer-placeholder-shown:normal-case peer-placeholder-shown:tracking-normal
                           peer-focus:-top-2.5 peer-focus:translate-y-0 peer-focus:bg-[#121212] peer-focus:text-[10px] peer-focus:text-[#D4AF37] peer-focus:uppercase peer-focus:tracking-widest"
            >
              {t.subject}
            </label>
          </div>

          <div class="relative group">
            <textarea
              id="message"
              name="message"
              rows="5"
              required
              placeholder=" "
              class="peer w-full px-5 py-4 rounded-xl bg-black/40 border border-white/10 text-[#E5E4E2] focus:border-[#D4AF37]/50 focus:ring-1 focus:ring-[#D4AF37]/50 outline-none transition-all duration-300 resize-none min-h-[150px]"
            ></textarea>
            <label
              for="message"
              class="absolute left-4 -top-2.5 px-1 rounded bg-[#121212] text-[10px] items-center uppercase tracking-widest text-[#D4AF37] font-display transition-all duration-300
                           peer-placeholder-shown:top-6 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:bg-transparent peer-placeholder-shown:text-base peer-placeholder-shown:text-neutral-500 peer-placeholder-shown:normal-case peer-placeholder-shown:tracking-normal
                           peer-focus:-top-2.5 peer-focus:translate-y-0 peer-focus:bg-[#121212] peer-focus:text-[10px] peer-focus:text-[#D4AF37] peer-focus:uppercase peer-focus:tracking-widest"
            >
              {t.message}
            </label>
          </div>

          <div class="pt-2">
            <Button
              type="submit"
              class="w-full justify-center group bg-gradient-to-r from-[#D4AF37] via-[#FDB931] to-[#D4AF37] !text-black font-display font-bold uppercase tracking-widest hover:shadow-[0_0_30px_rgba(212,175,55,0.4)] transition-all duration-500 hover:scale-100 active:scale-100 hover:!translate-y-0"
            >
              {t.send}
              <Send
                className="w-4 h-4 ml-2 group-hover:translate-x-10 group-hover:rotate-[360deg] transition-all duration-700 ease-in-out !text-black"
              />
            </Button>
          </div>
        </form>
      </div>
    </div>
  </div>

  {/* Toast Notification Container */}
  <div
    id="toast-container"
    class="fixed bottom-6 right-6 z-50 max-w-md w-full px-4 pointer-events-none"
  >
    <div
      id="toast"
      class="hidden transform translate-y-full opacity-0 transition-all duration-500 ease-out pointer-events-auto"
    >
      <div
        id="toast-content"
        class="relative flex items-start gap-4 p-5 rounded-2xl border backdrop-blur-xl shadow-2xl"
      >
        {/* Icon */}
        <div
          id="toast-icon"
          class="shrink-0 w-10 h-10 rounded-full flex items-center justify-center"
        >
          <svg
            id="toast-icon-success"
            class="hidden w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 13l4 4L19 7"></path>
          </svg>
          <svg
            id="toast-icon-error"
            class="hidden w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </div>
        {/* Text */}
        <div class="flex-1 min-w-0">
          <p id="toast-title" class="font-display font-bold text-lg"></p>
          <p id="toast-message" class="text-sm opacity-80 mt-1"></p>
        </div>
        {/* Close Button */}
        <button
          id="toast-close"
          class="shrink-0 p-1.5 rounded-full hover:bg-white/10 transition-colors"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    import emailjs from "@emailjs/browser";

    const serviceID = import.meta.env.PUBLIC_EMAILJS_SERVICE_ID;
    const templateID = import.meta.env.PUBLIC_EMAILJS_TEMPLATE_ID;
    const publicKey = import.meta.env.PUBLIC_EMAILJS_PUBLIC_KEY;

    // Initialize EmailJS
    emailjs.init({
      publicKey: publicKey,
    });

    // Toast Elements
    const toast = document.getElementById("toast");
    const toastContent = document.getElementById("toast-content");
    const toastTitle = document.getElementById("toast-title");
    const toastMessage = document.getElementById("toast-message");
    const toastIconSuccess = document.getElementById("toast-icon-success");
    const toastIconError = document.getElementById("toast-icon-error");
    const toastIcon = document.getElementById("toast-icon");
    const toastClose = document.getElementById("toast-close");

    let toastTimeout: ReturnType<typeof setTimeout>;

    function showToast(
      type: "success" | "error",
      title: string,
      message: string,
    ) {
      if (
        !toast ||
        !toastContent ||
        !toastTitle ||
        !toastMessage ||
        !toastIconSuccess ||
        !toastIconError ||
        !toastIcon
      )
        return;

      // Reset
      clearTimeout(toastTimeout);
      toast.classList.remove("hidden");

      // Set content
      toastTitle.textContent = title;
      toastMessage.textContent = message;

      // Style based on type
      if (type === "success") {
        toastContent.className =
          "relative flex items-start gap-4 p-5 rounded-2xl border backdrop-blur-xl shadow-2xl bg-[#121212]/90 border-[#D4AF37]/30 text-[#E5E4E2]";
        toastIcon.className =
          "shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-[#D4AF37]/20 text-[#D4AF37]";
        toastIconSuccess.classList.remove("hidden");
        toastIconError.classList.add("hidden");
      } else {
        toastContent.className =
          "relative flex items-start gap-4 p-5 rounded-2xl border backdrop-blur-xl shadow-2xl bg-[#121212]/90 border-red-500/30 text-[#E5E4E2]";
        toastIcon.className =
          "shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-red-500/20 text-red-400";
        toastIconSuccess.classList.add("hidden");
        toastIconError.classList.remove("hidden");
      }

      // Animate in
      requestAnimationFrame(() => {
        toast.classList.remove("translate-y-full", "opacity-0");
        toast.classList.add("translate-y-0", "opacity-100");
      });

      // Auto dismiss after 5 seconds
      toastTimeout = setTimeout(() => hideToast(), 5000);
    }

    function hideToast() {
      if (!toast) return;
      toast.classList.remove("translate-y-0", "opacity-100");
      toast.classList.add("translate-y-full", "opacity-0");
      setTimeout(() => toast.classList.add("hidden"), 500);
    }

    // Close button
    toastClose?.addEventListener("click", hideToast);

    // Form submission
    const form = document.getElementById("contact-form") as HTMLFormElement;

    form?.addEventListener("submit", (e) => {
      e.preventDefault();

      const btn = form.querySelector('button[type="submit"]');
      const originalContent = btn ? btn.innerHTML : "";

      if (btn) {
        btn.innerHTML = "Mengirim...";
        (btn as HTMLButtonElement).disabled = true;
      }

      emailjs.sendForm(serviceID, templateID, form).then(
        () => {
          showToast(
            "success",
            "Pesan Terkirim!",
            "Terima kasih telah menghubungi saya. Saya akan membalas secepatnya.",
          );
          form.reset();
          if (btn) {
            btn.innerHTML = originalContent;
            (btn as HTMLButtonElement).disabled = false;
          }
        },
        (error) => {
          console.error("FAILED...", error);
          showToast(
            "error",
            "Gagal Mengirim",
            "Terjadi kesalahan. Silakan coba lagi atau hubungi langsung via WhatsApp.",
          );
          if (btn) {
            btn.innerHTML = originalContent;
            (btn as HTMLButtonElement).disabled = false;
          }
        },
      );
    });
  </script>
</section>
