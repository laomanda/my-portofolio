---
import { text } from "../../data/i18n";
import {
  Menu,
  X,
  Sun,
  Moon,
  Phone,
  Instagram,
  Github,
  Home,
  Briefcase,
  FolderOpen,
  User,
  Mail,
} from "@lucide/astro";
import StaggerChars from "../ui/stagger-chars";
import { DecoratedText } from "../ui/decorated-text";

const t = text.nav;

const navLinks = [
  { href: "#home", label: t.home, icon: Home },
  { href: "#about", label: t.about, icon: User },
  { href: "#projects", label: t.projects, icon: FolderOpen },
  { href: "#contact", label: t.contact, icon: Mail },
];
---

<!-- Floating Hamburger Button -->
<div class="fixed top-6 right-6 z-[100] flex items-center justify-center">
  <button
    id="menu-btn"
    class="relative w-16 h-16 rounded-full bg-light-bg/10 dark:bg-dark-bg/10 backdrop-blur-xl border border-white/20 dark:border-white/10 shadow-[0_8px_32px_0_rgba(31,38,135,0.37)] group transition-colors duration-300 overflow-hidden will-change-transform"
    aria-label="Menu"
  >
    <!-- Inner Glow -->
    <div
      class="absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500 bg-gradient-to-tr from-light-accent/20 to-transparent dark:from-dark-accent/20"
    >
    </div>

    <!-- Magnetic Area Wrapper -->
    <div
      class="relative z-10 w-full h-full flex items-center justify-center"
      id="menu-btn-content"
    >
      <div id="menu-icon-open" class="absolute ease-out group-hover:scale-110">
        <div class="flex flex-col gap-1.5 items-end">
          <span
            class="w-8 h-[2px] bg-light-textPrimary dark:text-dark-textPrimary dark:bg-white rounded-full transition-all duration-300 group-hover:w-6"
          ></span>
          <span
            class="w-6 h-[2px] bg-light-textPrimary dark:text-dark-textPrimary dark:bg-white rounded-full transition-all duration-300 group-hover:w-8"
          ></span>
        </div>
      </div>
      <div id="menu-icon-close" class="absolute scale-0 opacity-0 rotate-0">
        <X class="w-8 h-8 text-light-accent dark:text-yellow-500" />
      </div>
    </div>
  </button>
</div>

<!-- Fullscreen Overlay Menu -->
<div
  id="full-menu"
  class="fixed inset-0 bg-light-bg/95 dark:bg-dark-bg/95 backdrop-blur-2xl z-[90] translate-x-full transition-transform flex flex-col justify-center items-center"
  style="transition-duration: 800ms; transition-timing-function: cubic-bezier(0.87, 0, 0.13, 1);"
>
  <!-- Grid Pattern Background for visual interest -->
  <div
    class="absolute inset-0 opacity-5 pointer-events-none bg-[url('/grid.svg')] bg-center"
  >
  </div>

  <!-- Main Content Area -->
  <div
    class="flex flex-col md:flex-row items-center justify-center w-full h-full px-6 md:px-12 relative z-10 gap-8 md:gap-20 lg:gap-32"
  >
    <!-- Name - Left Side -->
    <div class="menu-profile opacity-0 text-center md:text-left">
      <h3
        class="font-bold text-light-textPrimary dark:text-dark-textPrimary uppercase tracking-widest leading-none"
      >
        <DecoratedText
          client:load
          className="text-3xl md:text-7xl lg:text-9xl font-display"
          flicker={true}
          bordered={true}
          showIcons={true}
        >
          Jakkob<br />Oktapianus<br />Michael<br />Panjaitan
        </DecoratedText>
      </h3>
    </div>

    <!-- Menu Links - Right Side -->
    <div
      class="flex flex-col gap-4 md:gap-6 items-center md:items-start text-center md:text-left"
    >
      {
        navLinks.map((link, index) => (
          <a
            href={link.href}
            class="menu-link flex items-center gap-4 md:gap-5 transition-all duration-300 group relative tracking-tight opacity-0"
          >
            <link.icon
              class="w-5 h-5 md:w-8 md:h-8 lg:w-12 lg:h-12 text-light-textPrimary dark:text-dark-textPrimary group-hover:text-yellow-500 transition-colors duration-300"
              stroke-width="1.5"
            />

            <StaggerChars
              client:load
              text={link.label}
              className="text-xl md:text-3xl lg:text-5xl font-serif font-black text-light-textPrimary dark:text-dark-textPrimary"
              hoverClassName="text-yellow-500"
            />
          </a>
        ))
      }
    </div>
  </div>

  <!-- Controls - Right Bottom -->
  <div
    class="absolute bottom-8 left-0 right-0 md:bottom-12 md:left-auto md:right-12 flex justify-center md:justify-end items-center gap-6 menu-controls z-30 opacity-0 px-6"
  >
    <!-- Social Icons -->
    <div class="flex items-center gap-4">
      <!-- WhatsApp -->
      <a
        href="https://wa.me/62895321205351"
        target="_blank"
        rel="noopener noreferrer"
        class="social-icon group relative p-2"
      >
        <div
          class="absolute inset-0 bg-yellow-400/20 blur-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        >
        </div>
        <Phone
          class="w-6 h-6 text-light-textPrimary dark:text-dark-textPrimary group-hover:text-[#25D366] transition-colors relative z-10"
        />
      </a>

      <!-- Instagram -->
      <a
        href="https://www.instagram.com/jakk_0b/"
        target="_blank"
        rel="noopener noreferrer"
        class="social-icon group relative p-2"
      >
        <div
          class="absolute inset-0 bg-yellow-400/20 blur-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        >
        </div>
        <Instagram
          class="w-6 h-6 text-light-textPrimary dark:text-dark-textPrimary group-hover:text-[#E1306C] transition-colors relative z-10"
        />
      </a>

      <!-- Github -->
      <a
        href="https://github.com/laomanda"
        target="_blank"
        rel="noopener noreferrer"
        class="social-icon group relative p-2"
      >
        <div
          class="absolute inset-0 bg-yellow-400/20 blur-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        >
        </div>
        <Github
          class="w-6 h-6 text-light-textPrimary dark:text-dark-textPrimary group-hover:text-[#181717] dark:group-hover:text-white transition-colors relative z-10"
        />
      </a>
    </div>
  </div>

  <script>
    import { gsap } from "gsap";

    document.addEventListener("astro:page-load", () => {
      // Re-select elements on every page load
      const menuBtn = document.getElementById("menu-btn");
      const menuIconOpen = document.getElementById("menu-icon-open");
      const menuIconClose = document.getElementById("menu-icon-close");
      const fullMenu = document.getElementById("full-menu");
      const menuLinks = document.querySelectorAll(".menu-link");
      const menuControls = document.querySelector(".menu-controls");
      const menuProfile = document.querySelector(".menu-profile");
      const menuBtnContent = document.getElementById("menu-btn-content");

      let isMenuOpen = false;

      // --- Magnetic Effect ---
      if (menuBtn && menuBtnContent) {
        menuBtn.addEventListener("mousemove", (e) => {
          const rect = menuBtn.getBoundingClientRect();
          const x = e.clientX - rect.left - rect.width / 2;
          const y = e.clientY - rect.top - rect.height / 2;

          // Move the button container slightly
          gsap.to(menuBtn, {
            x: x * 0.3,
            y: y * 0.3,
            duration: 0.5,
            ease: "power3.out",
          });

          // Move the icon content more (parallax effect)
          gsap.to(menuBtnContent, {
            x: x * 0.5,
            y: y * 0.5,
            duration: 0.5,
            ease: "power3.out",
          });
        });

        menuBtn.addEventListener("mouseleave", () => {
          gsap.to([menuBtn, menuBtnContent], {
            x: 0,
            y: 0,
            duration: 1,
            ease: "elastic.out(1, 0.3)",
          });
        });
      }

      // --- Menu Toggle ---
      menuBtn?.addEventListener("click", () => {
        isMenuOpen = !isMenuOpen;
        toggleMenu();
      });

      menuLinks.forEach((link) => {
        link.addEventListener("click", () => {
          isMenuOpen = false;
          toggleMenu();
        });
      });

      function toggleMenu() {
        if (isMenuOpen) {
          fullMenu?.classList.remove("translate-x-full");
          document.body.classList.add("menu-open");
          window.dispatchEvent(
            new CustomEvent("menu:toggle", {
              detail: { open: true },
            }),
          );

          // Icon Animation (Simulate Hamburger to X)
          gsap.to(menuIconOpen, {
            scale: 0,
            opacity: 0,
            duration: 0.3,
          });
          menuIconClose?.classList.remove("hidden");
          gsap.to(menuIconClose, {
            scale: 1,
            opacity: 1,
            rotation: 90,
            duration: 0.5,
            ease: "back.out(1.7)",
          });

          // Links Animation - Light (Fade + Slight Slide up)
          gsap.fromTo(
            menuLinks,
            { y: 20, opacity: 0 },
            {
              y: 0,
              opacity: 1,
              duration: 0.4,
              stagger: 0.05,
              ease: "power2.out",
              delay: 0.2, // Wait for background slighty
            },
          );

          gsap.fromTo(
            menuControls,
            { y: 15, opacity: 0 },
            {
              y: 0,
              opacity: 1,
              duration: 0.4,
              delay: 0.3, // Wait for links
              ease: "power2.out",
            },
          );

          gsap.fromTo(
            menuProfile,
            { x: -20, opacity: 0 },
            {
              x: 0,
              opacity: 1,
              duration: 0.5,
              delay: 0.35,
              ease: "power2.out",
            },
          );

          document.body.style.overflow = "hidden";
        } else {
          fullMenu?.classList.add("translate-x-full");
          document.body.classList.remove("menu-open");
          window.dispatchEvent(
            new CustomEvent("menu:toggle", {
              detail: { open: false },
            }),
          );

          // Icon Animation (X to Hamburger)
          gsap.to(menuIconClose, {
            scale: 0,
            opacity: 0,
            rotation: 0,
            duration: 0.3,
          });
          gsap.to(menuIconOpen, {
            scale: 1,
            opacity: 1,
            duration: 0.5,
            delay: 0.1,
            ease: "back.out(1.7)",
          });

          // Links Animation (Exit - Smooth Fade Out)
          gsap.to(menuLinks, {
            opacity: 0,
            y: 20,
            duration: 0.6,
            stagger: 0.05,
            ease: "power2.in",
          });
          gsap.to(menuControls, {
            opacity: 0,
            y: 15,
            duration: 0.6,
            ease: "power2.in",
          });
          gsap.to(menuProfile, {
            opacity: 0,
            x: -20,
            duration: 0.6,
            ease: "power2.in",
          });

          document.body.style.overflow = "auto";
        }
      }
    });
  </script>
</div>
